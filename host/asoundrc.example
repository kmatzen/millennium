# ---- HW mixing on the USB card (card 1, device 0)
pcm.dmix_usb {
    type dmix
    ipc_key 1024
    slave {
        pcm "hw:1,0"     # adjust if your USB isn't card 1
        rate 48000
        channels 2
        period_time 0
        period_size 1024
        buffer_size 4096
    }
}

# ---- Soft gain core on top of dmix
pcm.softvol_core {
    type softvol
    slave.pcm "dmix_usb"
    control {
        name "SoftUSB"
        card 1
    }
    max_dB 24.0
}

# ---- Keep your original "default" path as-is
pcm.softvol_usb {
    type plug
    slave.pcm "softvol_core"
}

# ==============================================
# Per-channel outputs (robust for mono or stereo)
# ==============================================

# --- LEFT duplicated to both ears
pcm.out_left_dup {
    type plug
    slave.pcm "route_left_dup"
}
pcm.route_left_dup {
    type route
    slave {
        pcm "softvol_core"
        channels 2
    }
    # Input: 2ch expected (plug will upmix mono if needed)
    ttable.0.0 1     # L -> L
    ttable.0.1 1     # L -> R
    ttable.1.0 0     # R -> L (off)
    ttable.1.1 0     # R -> R (off)
}

# --- RIGHT duplicated to both ears
pcm.out_right_dup {
    type plug
    slave.pcm "route_right_dup"
}
pcm.route_right_dup {
    type route
    slave {
        pcm "softvol_core"
        channels 2
    }
    ttable.1.0 1     # R -> L
    ttable.1.1 1     # R -> R
    ttable.0.0 0     # L -> L (off)
    ttable.0.1 0     # L -> R (off)
}

# --- LEFT solo (keep stereo field, mute right ear)
pcm.out_left_solo {
    type plug
    slave.pcm "route_left_solo"
}

pcm.route_left_solo {
    type route
    slave {
        pcm "softvol_core"
        channels 2
    }
    # Right OUT: force silence
    ttable.0.1 0    # L(in) -> R(out)
    ttable.1.1 0    # R(in) -> R(out)

    # Left OUT: mix L and R at 50% each (avoids clipping)
    ttable.0.0 0.5  # L(in) -> L(out)
    ttable.1.0 0.5  # R(in) -> L(out)
}


# --- RIGHT solo (keep stereo field, mute left ear)
pcm.out_right_solo {
    type plug
    slave.pcm "route_right_solo"
}

pcm.route_right_solo {
    type route
    slave {
        pcm "softvol_core"
        channels 2
    }
    # Left OUT: force silence
    ttable.0.0 0    # L(in) -> L(out)
    ttable.1.0 0    # R(in) -> L(out)

    # Right OUT: mix L and R at 50% each (avoids clipping)
    ttable.0.1 0.5  # L(in) -> R(out)
    ttable.1.1 0.5  # R(in) -> R(out)
}


# ---- Keep your defaults
pcm.!default {
    type plug
    slave.pcm "softvol_usb"
}
ctl.!default {
    type hw
    card 1
}

